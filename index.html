<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quay Crane (QC) Inspection Checklist - Complete Form</title>

  <style>
    :root{
      --csp-blue:#0b4f8a;
      --csp-light:#e8f1fb;
      --csp-grey:#f2f2f2;
      --csp-dark:#1f2937;
      --line:#111;
      --soft:#6b7280;
    }

    body{
      font-family: Arial, Helvetica, sans-serif;
      background:#f4f6f8;
      padding:20px;
      color:#000;
    }
    .page{
      max-width: 1200px;
      margin:auto;
      background:#fff;
      border:1px solid #000;
      padding:18px;
      position:relative;
      min-height: calc(100vh - 40px);
      padding-bottom:160px;
    }

    /* Header */
    .header{ margin:6px 0 18px; text-align:center; }
    .header-with-logo{
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap:16px;
      border-bottom:3px solid var(--csp-blue);
      padding-bottom:10px;
      margin-bottom:12px;
    }
    .header-text{ display:flex; flex-direction:column; gap:6px; }
    .header .org{ font-size:18px; font-weight:700; color:var(--csp-blue); text-align:left; }
    .header .title{ font-size:15px; font-weight:700; text-decoration:underline; margin-top:10px; text-align:center; color:var(--csp-dark); }
    .hdr-logo{ height:75px; width:auto; justify-self:end; }

    .meta{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin: 14px 0 12px;
    }
    .field label{
      font-size:12px;
      font-weight:700;
      display:block;
      margin-bottom:4px;
    }
    input[type="text"], input[type="date"], input[type="time"], select, textarea{
      width:100%;
      border:1px solid #666;
      border-radius:4px;
      padding:6px;
      font-size:13px;
      box-sizing:border-box;
    }
    textarea{ min-height:58px; resize:vertical; overflow:auto; }

    .locked{ background:#f2f2f2; pointer-events:none; }

    .section-title{
      background:var(--csp-light);
      border:1px solid var(--csp-blue);
      color:var(--csp-blue);
      padding:6px 10px;
      font-weight:700;
      margin:18px 0 8px;
      text-align:center;
      text-decoration:none;
    }

    table{ width:100%; border-collapse:collapse; }
    th, td{ border:1px solid #000; padding:8px; font-size:13px; vertical-align:top; }
    th{ background:var(--csp-grey) !important; color:var(--csp-dark); }
    .center{ text-align:center; }
    .w-sn{ width:55px; }
    .w-cond{ width:220px; }
    .w-photo{ width:240px; }
    .w-status{ width:140px; }

    .opt{ margin-right:10px; white-space:nowrap; display:inline-block; }

    /* Photo cell */
    .photo-cell{
      border:1px dashed #777;
      padding:6px;
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:stretch;
    }
    .photo-cell input[type="file"]{ width:100%; font-size:12px; }
    .thumb{
      margin-top:0;
      height:110px;
      border:1px solid #bbb;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:#666;
      overflow:hidden;
      background:#fff;
    }
    .thumb img{ width:100%; height:100%; object-fit:contain; }

    /* Textareas */
    .obs-ta, .rec-ta{ height:110px; min-height:110px; max-height:220px; }
    .chk-remarks{ height:70px; min-height:70px; max-height:160px; }

    /* Buttons */
    button{
      padding:8px 14px;
      font-size:14px;
      border:1px solid var(--csp-blue);
      background:var(--csp-blue);
      color:#fff;
      border-radius:6px;
      cursor:pointer;
    }
    button.secondary{ background:#fff; color:var(--csp-blue); }
    button.danger{ background:#c0392b; border-color:#c0392b; color:#fff; }
    button.secondary.danger{ background:#fff; color:#c0392b; border-color:#c0392b; }

    .actions{
      margin-top:18px;
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }

    /* Signatures */
    .sign-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
      margin-top:10px;
    }
    .sigbox{ border:1px solid #000; padding:10px; }
    canvas{
      width:100%;
      height:130px;
      border:1px solid #000;
      border-radius:6px;
      background:#fff;
      touch-action:none;
    }
    .sig-actions{ display:flex; gap:10px; margin-top:8px; justify-content:flex-end; }

    /* Footer inside border */
    .footer{
      position:absolute;
      left:18px;
      right:18px;
      bottom:18px;
      background:#fff;
      z-index:2;
    }
    .footer-table{
      width:100% !important;
      max-width:100%;
      margin:0;
      border-collapse:collapse;
      table-layout:fixed;
      font-size:12px;
    }
    .footer-table th, .footer-table td{
      border:1px solid #6b7280;
      padding:6px 8px;
      text-align:center;
    }
    .footer-table th{
      background:#ffffff !important;
      color:#6b7280;
      font-weight:700;
    }
    .footer-table td{
      font-weight:600;
      color:#4b5563;
    }

    /* Print */
    @media print{
      body{ background:#fff; padding:0; }
      .page{ border:none; min-height:auto; padding-bottom:0; }
      .actions, .sig-actions, #addObsRowBtn, .obs-del-btn{ display:none !important; }
      input, textarea, select{ border:0; }
      .photo-cell input[type="file"]{ display:none; }
      .footer{
        position:fixed;
        left:18px;
        right:18px;
        bottom:12px;
      }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="header header-with-logo">
      <div class="header-text">
        <div class="org">CSP Abu Dhabi Terminal Environment, Health and Safety Management</div>
        <div class="title">Quay crane (QC) Inspection checklist</div>
      </div>
      <img class="hdr-logo" src="logo.png" alt="CSPADT Logo">
    </div>

    <form id="qcForm" method="POST" action="https://script.google.com/macros/s/AKfycbzmzWUi86tktkVWrm0DOjuK5XE8vEAKh8GcIBe1vWR45dN7dxsEJEAWUKTF_a4nlPs4/exec">
      <div class="meta">
        <div class="field">
          <label>QC No</label>
          <select name="qcNo">
            <option value="">Select QC</option>
            <option>QC 101</option><option>QC 102</option><option>QC 103</option><option>QC 104</option><option>QC 105</option>
            <option>QC 106</option><option>QC 107</option><option>QC 108</option><option>QC 109</option><option>QC 110</option><option>QC 111</option>
          </select>
        </div>

        <div class="field"><label>Date Inspected</label><input type="date" name="dateInspected" class="locked" readonly /></div>
        <div class="field"><label>Time</label><input type="time" name="timeInspected" class="locked" readonly /></div>
        <div class="field"><label>Location</label><input type="text" name="location" /></div>

        <div class="field"><label>Inspector Name</label><input type="text" name="inspectorName" /></div>
        <div class="field"><label>Department / Company</label><input type="text" name="company" /></div>

        <div class="field">
          <label>Weather</label>
          <select name="weather">
            <option value="">Select</option><option>Clear</option><option>Sunny</option><option>Windy</option><option>Dusty</option><option>Rain</option><option>Humid</option>
          </select>
        </div>

        <div class="field">
          <label>Shift</label>
          <select name="shift">
            <option value="">Select</option><option>Day</option><option>Night</option>
          </select>
        </div>
      </div>

      <div class="section-title">Checklist</div>
      <table>
        <thead>
          <tr>
            <th class="w-sn">S/N</th>
            <th>Inspection Item</th>
            <th class="w-cond">Condition</th>
            <th>Remarks / Corrective Action</th>
            <th class="w-photo">Photos</th>
          </tr>
        </thead>

        <tbody>

<!-- ===================== CHECKLIST ROWS (1..30) ===================== -->
<!-- IMPORTANT FIX:
     Each row now has:
     1) data-hidden="photo_cX" on file input
     2) hidden input name="photo_cX"  (so Apps Script receives base64 thumbnail)
-->

<tr>
  <td class="center">1</td>
  <td>Crane identification number and SWL load charts clearly displayed?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_1" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_1" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_1" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_1" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c1" data-hidden="photo_c1" />
      <input type="hidden" name="photo_c1" id="photo_c1" />
      <div class="thumb" id="c1">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">2</td>
  <td>No visible structural damage, corrosion, or deformation.</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_2" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_2" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_2" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_2" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c2" data-hidden="photo_c2" />
      <input type="hidden" name="photo_c2" id="photo_c2" />
      <div class="thumb" id="c2">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">3</td>
  <td>Housekeeping satisfactory (no loose items, oil spills, or obstructions)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_3" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_3" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_3" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_3" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c3" data-hidden="photo_c3" />
      <input type="hidden" name="photo_c3" id="photo_c3" />
      <div class="thumb" id="c3">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">4</td>
  <td>Walkways, ladders, platforms, and handrails are in good condition.</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_4" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_4" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_4" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_4" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c4" data-hidden="photo_c4" />
      <input type="hidden" name="photo_c4" id="photo_c4" />
      <div class="thumb" id="c4">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">5</td>
  <td>Gantry limit sensor functioning?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_5" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_5" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_5" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_5" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c5" data-hidden="photo_c5" />
      <input type="hidden" name="photo_c5" id="photo_c5" />
      <div class="thumb" id="c5">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">6</td>
  <td>Wire ropes in good condition (no broken strands, kinks, corrosion)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_6" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_6" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_6" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_6" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c6" data-hidden="photo_c6" />
      <input type="hidden" name="photo_c6" id="photo_c6" />
      <div class="thumb" id="c6">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">7</td>
  <td>Load limiters operational?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_7" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_7" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_7" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_7" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c7" data-hidden="photo_c7" />
      <input type="hidden" name="photo_c7" id="photo_c7" />
      <div class="thumb" id="c7">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">8</td>
  <td>Spreaders free from damage?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_8" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_8" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_8" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_8" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c8" data-hidden="photo_c8" />
      <input type="hidden" name="photo_c8" id="photo_c8" />
      <div class="thumb" id="c8">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">9</td>
  <td>Control panels secured and labelled?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_9" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_9" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_9" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_9" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c9" data-hidden="photo_c9" />
      <input type="hidden" name="photo_c9" id="photo_c9" />
      <div class="thumb" id="c9">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">10</td>
  <td>Adequate lighting (cabin, walkways, boom, and landside)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_10" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_10" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_10" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_10" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c10" data-hidden="photo_c10" />
      <input type="hidden" name="photo_c10" id="photo_c10" />
      <div class="thumb" id="c10">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">11</td>
  <td>Any exposed or damaged cables?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_11" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_11" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_11" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_11" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c11" data-hidden="photo_c11" />
      <input type="hidden" name="photo_c11" id="photo_c11" />
      <div class="thumb" id="c11">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">12</td>
  <td>Cabin clean and ergonomically safe?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_12" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_12" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_12" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_12" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c12" data-hidden="photo_c12" />
      <input type="hidden" name="photo_c12" id="photo_c12" />
      <div class="thumb" id="c12">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">13</td>
  <td>Seat, seatbelt, joystick, and controls in good condition?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_13" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_13" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_13" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_13" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c13" data-hidden="photo_c13" />
      <input type="hidden" name="photo_c13" id="photo_c13" />
      <div class="thumb" id="c13">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">14</td>
  <td>Clear visibility (windows, wipers, defoggers working)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_14" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_14" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_14" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_14" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c14" data-hidden="photo_c14" />
      <input type="hidden" name="photo_c14" id="photo_c14" />
      <div class="thumb" id="c14">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">15</td>
  <td>Fire extinguisher available and inspected?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_15" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_15" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_15" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_15" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c15" data-hidden="photo_c15" />
      <input type="hidden" name="photo_c15" id="photo_c15" />
      <div class="thumb" id="c15">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">16</td>
  <td>Communication system (radio/intercom) functional?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_16" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_16" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_16" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_16" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c16" data-hidden="photo_c16" />
      <input type="hidden" name="photo_c16" id="photo_c16" />
      <div class="thumb" id="c16">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">17</td>
  <td>Audible alarms and warning horns working?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_17" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_17" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_17" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_17" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c17" data-hidden="photo_c17" />
      <input type="hidden" name="photo_c17" id="photo_c17" />
      <div class="thumb" id="c17">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">18</td>
  <td>Emergency stop buttons functional and accessible?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_18" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_18" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_18" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_18" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c18" data-hidden="photo_c18" />
      <input type="hidden" name="photo_c18" id="photo_c18" />
      <div class="thumb" id="c18">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">19</td>
  <td>Anti-collision and interlock systems working (if applicable)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_19" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_19" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_19" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_19" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c19" data-hidden="photo_c19" />
      <input type="hidden" name="photo_c19" id="photo_c19" />
      <div class="thumb" id="c19">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">20</td>
  <td>Safe access/egress maintained (no missing gratings, covers)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_20" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_20" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_20" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_20" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c20" data-hidden="photo_c20" />
      <input type="hidden" name="photo_c20" id="photo_c20" />
      <div class="thumb" id="c20">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">21</td>
  <td>Boom angle indicator and limits working?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_21" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_21" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_21" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_21" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c21" data-hidden="photo_c21" />
      <input type="hidden" name="photo_c21" id="photo_c21" />
      <div class="thumb" id="c21">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">22</td>
  <td>Trolley travel and brakes functioning?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_22" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_22" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_22" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_22" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c22" data-hidden="photo_c22" />
      <input type="hidden" name="photo_c22" id="photo_c22" />
      <div class="thumb" id="c22">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">23</td>
  <td>Hoist brake functioning and no abnormal noises?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_23" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_23" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_23" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_23" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c23" data-hidden="photo_c23" />
      <input type="hidden" name="photo_c23" id="photo_c23" />
      <div class="thumb" id="c23">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">24</td>
  <td>Skew control / travel alignment normal?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_24" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_24" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_24" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_24" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c24" data-hidden="photo_c24" />
      <input type="hidden" name="photo_c24" id="photo_c24" />
      <div class="thumb" id="c24">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">25</td>
  <td>Storm pins / tie-downs available and in good condition?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_25" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_25" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_25" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_25" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c25" data-hidden="photo_c25" />
      <input type="hidden" name="photo_c25" id="photo_c25" />
      <div class="thumb" id="c25">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">26</td>
  <td>Anemometer / wind speed display functional (if installed)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_26" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_26" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_26" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_26" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c26" data-hidden="photo_c26" />
      <input type="hidden" name="photo_c26" id="photo_c26" />
      <div class="thumb" id="c26">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">27</td>
  <td>PPE signage and safety instructions visible?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_27" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_27" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_27" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_27" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c27" data-hidden="photo_c27" />
      <input type="hidden" name="photo_c27" id="photo_c27" />
      <div class="thumb" id="c27">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">28</td>
  <td>Any oil leaks from hydraulic systems?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_28" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_28" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_28" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_28" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c28" data-hidden="photo_c28" />
      <input type="hidden" name="photo_c28" id="photo_c28" />
      <div class="thumb" id="c28">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">29</td>
  <td>Lubrication points maintained and no excessive grease on walkways?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_29" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_29" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_29" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_29" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c29" data-hidden="photo_c29" />
      <input type="hidden" name="photo_c29" id="photo_c29" />
      <div class="thumb" id="c29">No image</div>
    </div>
  </td>
</tr>

<tr>
  <td class="center">30</td>
  <td>Fire detection / suppression system healthy (if installed)?</td>
  <td class="center">
    <label class="opt"><input type="radio" name="cond_30" value="Yes"> Yes </label>
    <label class="opt"><input type="radio" name="cond_30" value="NOT_Yes"> No </label>
    <label class="opt"><input type="radio" name="cond_30" value="NA"> N/A</label>
  </td>
  <td><textarea class="chk-remarks" name="remarks_30" placeholder="Finding / action / responsible / due date"></textarea></td>
  <td>
    <div class="photo-cell">
      <input type="file" accept="image/*" data-preview="c30" data-hidden="photo_c30" />
      <input type="hidden" name="photo_c30" id="photo_c30" />
      <div class="thumb" id="c30">No image</div>
    </div>
  </td>
</tr>

<!-- ===================== END CHECKLIST ROWS ===================== -->

        </tbody>
      </table>

      <div class="section-title">Observations / Recommendations</div>
      <table>
        <thead>
          <tr>
            <th class="w-sn">S/N</th>
            <th>Observations</th>
            <th class="w-photo">Photos</th>
            <th>Recommendations</th>
            <th class="w-status">Status</th>
            <th class="center" style="width:90px;">Action</th>
          </tr>
        </thead>
        <tbody id="obsBody"></tbody>
      </table>

      <div style="margin:10px 0; text-align:right;">
        <button type="button" id="addObsRowBtn" class="secondary">Add New Observation Row</button>
      </div>

      <div class="section-title">Signatures</div>
      <div class="sign-grid">
        <div class="sigbox">
          <b>HSE Inspector</b><br><br>
          <label>HSE Inspector Name</label>
          <input type="text" name="hseInspectorName" placeholder="Type name" />
          <div style="margin-top:10px;">
            <canvas id="sig1"></canvas>
            <input type="hidden" name="sig_hseInspector" id="sig_hseInspector" />
          </div>
          <div style="margin-top:8px; display:flex; justify-content:space-between; gap:10px; align-items:center;">
            <div><b>Date:</b> <input type="date" name="hseInspectorSignDate" style="width:170px" /></div>
            <div class="sig-actions">
              <button type="button" class="secondary" onclick="clearSig('sig1','sig_hseInspector')">Clear</button>
            </div>
          </div>
        </div>

        <div class="sigbox">
          <b>HSSE Manager (HSSEM)</b><br><br>
          <label>HSSE Manager Name</label>
          <input type="text" name="hsseManagerName" placeholder="Type name" />
          <div style="margin-top:10px;">
            <canvas id="sig2"></canvas>
            <input type="hidden" name="sig_hsseManager" id="sig_hsseManager" />
          </div>
          <div style="margin-top:8px; display:flex; justify-content:space-between; gap:10px; align-items:center;">
            <div><b>Date:</b> <input type="date" name="hsseManagerSignDate" style="width:170px" /></div>
            <div class="sig-actions">
              <button type="button" class="secondary" onclick="clearSig('sig2','sig_hsseManager')">Clear</button>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="submit">Send</button>
        <button type="button" class="secondary" onclick="resetAll()">Clear Form</button>
      </div>

      <!-- FOOTER -->
      <div class="footer">
        <table class="footer-table" aria-label="Document Footer">
          <thead>
            <tr>
              <th>Prepared By</th>
              <th>Reviewed By</th>
              <th>Page No</th>
              <th>Revision</th>
              <th>Control #</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="ft-val">HSSE Committee Team</td>
              <td class="ft-val">Abdul Rouf</td>
              <td class="ft-val">Page 1 of 2</td>
              <td class="ft-val">1.0</td>
              <td class="ft-val">CSP-HSSE-FRM-076</td>
            </tr>
          </tbody>
        </table>
      </div>

    </form>
  </div>

  <script>
    /************ AUTO DATE + TIME + DEFAULT 1 OBS ROW ************/
    document.addEventListener('DOMContentLoaded', () => {
      const dInp = document.querySelector('input[name="dateInspected"]');
      const tInp = document.querySelector('input[name="timeInspected"]');
      const now = new Date();

      if(dInp){
        const yyyy = now.getFullYear();
        const mm = String(now.getMonth() + 1).padStart(2,'0');
        const dd = String(now.getDate()).padStart(2,'0');
        dInp.value = `${yyyy}-${mm}-${dd}`;
        dInp.readOnly = true;
      }
      if(tInp){
        const hh = String(now.getHours()).padStart(2,'0');
        const mi = String(now.getMinutes()).padStart(2,'0');
        tInp.value = `${hh}:${mi}`;
        tInp.readOnly = true;
      }

      const addBtn = document.getElementById('addObsRowBtn');
      if(addBtn) addBtn.addEventListener('click', addObservationRow);

      const tbody = document.getElementById('obsBody');
      if(tbody){
        tbody.innerHTML = '';
        addObservationRow(); // ONE row only by default
      }
      renumberObservationRows();

      setupPad('sig1','sig_hseInspector');
      setupPad('sig2','sig_hsseManager');
    });

    /************ THUMBNAILS -> HIDDEN INPUTS (OPTION 1) ************/
    async function fileToThumbDataUrl(file, maxW=1200, maxH=1200, quality=0.80){
      const dataUrl = await new Promise((res, rej) => {
        const r = new FileReader();
        r.onload = () => res(r.result);
        r.onerror = rej;
        r.readAsDataURL(file);
      });

      const img = await new Promise((res, rej) => {
        const i = new Image();
        i.onload = () => res(i);
        i.onerror = rej;
        i.src = dataUrl;
      });

      const scale = Math.min(maxW / img.width, maxH / img.height, 1);
      const w = Math.round(img.width * scale);
      const h = Math.round(img.height * scale);

      const canvas = document.createElement('canvas');
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, w, h);

      return canvas.toDataURL('image/jpeg', quality);
    }

    document.addEventListener('change', async (e) => {
      const inp = e.target;
      if(!inp || !inp.matches('input[type="file"][data-preview]')) return;

      const previewId = inp.getAttribute('data-preview');
      const hiddenKey = inp.getAttribute('data-hidden'); // can be id or name
      const box = previewId ? document.getElementById(previewId) : null;

      const file = inp.files && inp.files[0];
      if(!file){
        if(box) box.textContent = "No image";
        if(hiddenKey){
          const h = document.getElementById(hiddenKey) || document.querySelector(`input[name="${hiddenKey}"]`);
          if(h) h.value = "";
        }
        return;
      }

      const thumbDataUrl = await fileToThumbDataUrl(file, 1200, 1200, 0.80);

      if(box) box.innerHTML = `<img alt="preview" src="${thumbDataUrl}">`;

      if(hiddenKey){
        const h = document.getElementById(hiddenKey) || document.querySelector(`input[name="${hiddenKey}"]`);
        if(h) h.value = thumbDataUrl;
      }
    });

    /************ OBSERVATIONS: ADD + DELETE + AUTO S/N + NAMES + PHOTO KEYS ************/
    function addObservationRow(){
      const tbody = document.getElementById('obsBody');
      if(!tbody) return;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="center"></td>
        <td><textarea class="obs-ta" name="" placeholder="Describe observation"></textarea></td>
        <td>
          <div class="photo-cell">
            <input type="file" accept="image/*" data-preview="" data-hidden="" />
            <input type="hidden" name="" />
            <div class="thumb">No image</div>
          </div>
        </td>
        <td><textarea class="rec-ta" name="" placeholder="Recommendation / corrective action"></textarea></td>
        <td>
          <select name="">
            <option value="">Select</option>
            <option>Open</option>
            <option>In Progress</option>
            <option>Closed</option>
          </select>
        </td>
        <td class="center"><button type="button" class="secondary danger obs-del-btn">Delete</button></td>
      `.trim();

      tbody.appendChild(tr);
      renumberObservationRows();
    }

    document.addEventListener('click', (e) => {
      const btn = e.target;
      if(btn && btn.classList && btn.classList.contains('obs-del-btn')){
        const tr = btn.closest('tr');
        if(tr){
          tr.remove();
          renumberObservationRows();
        }
      }
    });

    function renumberObservationRows(){
      const tbody = document.getElementById('obsBody');
      if(!tbody) return;

      const rows = Array.from(tbody.querySelectorAll('tr'));
      rows.forEach((tr, idx) => {
        const n = idx + 1;

        // S/N
        const snCell = tr.querySelector('td');
        if(snCell) snCell.textContent = n;

        // Fields
        const obs = tr.querySelector('textarea.obs-ta');
        const rec = tr.querySelector('textarea.rec-ta');
        const status = tr.querySelector('select');

        if(obs) obs.name = `obs_${n}`;
        if(rec) rec.name = `rec_${n}`;
        if(status) status.name = `status_${n}`;

        // Photo (preview + hidden field)
        const file = tr.querySelector('input[type="file"][data-preview]');
        const thumb = tr.querySelector('.thumb');
        const hidden = tr.querySelector('input[type="hidden"]');

        const pid = `o${n}`;            // preview div id
        const hidName = `photo_o${n}`;  // field sent to Apps Script

        if(file){
          file.setAttribute('data-preview', pid);
          file.setAttribute('data-hidden', hidName);
        }
        if(thumb){
          thumb.id = pid;
          if(!thumb.querySelector('img')) thumb.textContent = "No image";
        }
        if(hidden){
          hidden.name = hidName;
        }
      });
    }

    /************ RESET ************/
    function resetAll(){
      if(confirm("Clear everything?")){
        document.getElementById('qcForm').reset();
        document.querySelectorAll('.thumb').forEach(t => t.textContent = "No image");
        clearSig('sig1','sig_hseInspector');
        clearSig('sig2','sig_hsseManager');

        // Re-apply locked date/time + one obs row
        const tbody = document.getElementById('obsBody');
        if(tbody){ tbody.innerHTML = ''; addObservationRow(); renumberObservationRows(); }

        const now = new Date();
        const dInp = document.querySelector('input[name="dateInspected"]');
        const tInp = document.querySelector('input[name="timeInspected"]');
        if(dInp){
          const yyyy = now.getFullYear();
          const mm = String(now.getMonth() + 1).padStart(2,'0');
          const dd = String(now.getDate()).padStart(2,'0');
          dInp.value = `${yyyy}-${mm}-${dd}`;
        }
        if(tInp){
          const hh = String(now.getHours()).padStart(2,'0');
          const mi = String(now.getMinutes()).padStart(2,'0');
          tInp.value = `${hh}:${mi}`;
        }
      }
    }

    /************ SIGNATURE PADS ************/
    function setupPad(canvasId, hiddenId){
      const canvas = document.getElementById(canvasId);
      const hidden = document.getElementById(hiddenId);
      const ctx = canvas.getContext('2d');
      let drawing = false;

      function resize(){
        const rect = canvas.getBoundingClientRect();
        const ratio = window.devicePixelRatio || 1;
        canvas.width = Math.floor(rect.width * ratio);
        canvas.height = Math.floor(rect.height * ratio);
        ctx.setTransform(ratio,0,0,ratio,0,0);
        ctx.lineWidth = 2.2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.strokeStyle = '#000';
      }

      function pos(ev){
        const r = canvas.getBoundingClientRect();
        const e = ev.touches ? ev.touches[0] : ev;
        return { x: e.clientX - r.left, y: e.clientY - r.top };
      }

      function start(ev){ ev.preventDefault(); drawing = true; const p = pos(ev); ctx.beginPath(); ctx.moveTo(p.x,p.y); }
      function move(ev){ if(!drawing) return; ev.preventDefault(); const p = pos(ev); ctx.lineTo(p.x,p.y); ctx.stroke(); }
      function end(ev){ if(!drawing) return; ev.preventDefault(); drawing = false; if(hidden) hidden.value = canvas.toDataURL('image/png'); }

      canvas.addEventListener('mousedown', start);
      canvas.addEventListener('mousemove', move);
      window.addEventListener('mouseup', end);

      canvas.addEventListener('touchstart', start, {passive:false});
      canvas.addEventListener('touchmove', move, {passive:false});
      window.addEventListener('touchend', end, {passive:false});

      resize();
      window.addEventListener('resize', resize);
    }

    function clearSig(canvasId, hiddenId){
      const c = document.getElementById(canvasId);
      const ctx = c.getContext('2d');
      ctx.clearRect(0,0,c.width,c.height);
      const h = document.getElementById(hiddenId);
      if(h) h.value = '';
    }
  </script>

</body>
</html>
